<div class="page-wrapper">
  <h2><%= title %></h2>

  <form action="/admin/aquaculture_content/create" method="POST">

    <div class="form-group">
      <label>Lang</label>
      <input type="text" name="lang" value="<%= content.lang || '' %>" required>
    </div>

    <div class="form-group">
      <label>Title</label>
      <input type="text" name="title" value="<%= content.title || '' %>" required>
    </div>

    <div class="form-group">
      <div class="input-with-button">
        <input type="text" name="img_url" id="selectedImageInput" class="form-input" placeholder="Enter image or video URL">
        <button type="button" class="small-button openMediaModal" data-target="selectedImageInput">Choose</button>
      </div>
    </div>

    <div class="form-group">
      <label>Sub Title</label>
      <input type="text" name="sub_title" value="<%= content.sub_title || '' %>">
    </div>

    <div class="form-group">
      <label>Sub Title 1</label>
      <input type="text" name="sub_title1" value="<%= content.sub_title1 || '' %>">
    </div>

    <div class="form-group">
      <label>Sub Title 2</label>
      <input type="text" name="sub_title2" value="<%= content.sub_title2 || '' %>">
    </div>

    <div class="form-group">
      <div class="input-with-button">
        <input type="text" name="thumbnail" id="selectedThumbnail" class="form-input" placeholder="Enter Thumbnail URL" required>
        <button type="button" class="small-button openMediaModal" data-target="selectedThumbnail">Choose</button>
      </div>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description"><%= content.description || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Type Title</label>
      <input type="text" name="type_title" value="<%= content.type_title || '' %>">
    </div>

    <div class="form-group">
      <label>Type Text</label>
      <textarea name="type_text"><%= content.type_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Size Title</label>
      <input type="text" name="size_title" value="<%= content.size_title || '' %>">
    </div>

    <div class="form-group">
      <label>Size Text</label>
      <textarea name="size_text"><%= content.size_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Components Title</label>
      <input type="text" name="components_title" value="<%= content.components_title || '' %>">
    </div>

    <div class="form-group">
      <label>Components Text</label>
      <textarea name="components_text"><%= content.components_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Vitamin Title</label>
      <input type="text" name="vitamin_title" value="<%= content.vitamin_title || '' %>">
    </div>

    <div class="form-group">
      <label>Vitamin Text</label>
      <textarea name="vitamin_text"><%= content.vitamin_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Shelf Life Title</label>
      <input type="text" name="shelf_life_title" value="<%= content.shelf_life_title || '' %>">
    </div>

    <div class="form-group">
      <label>Shelf Life Text</label>
      <textarea name="shelf_life_text"><%= content.shelf_life_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Storage Conditions Title</label>
      <input type="text" name="storage_conditions_title" value="<%= content.storage_conditions_title || '' %>">
    </div>

    <div class="form-group">
      <label>Storage Conditions Text</label>
      <textarea name="storage_conditions_text"><%= content.storage_conditions_text || '' %></textarea>
    </div>

    <div class="form-group">
      <label>Characteristics Title</label>
      <input type="text" name="characteristics_title" value="<%= content.characteristics_title || '' %>">
    </div>

    <div class="form-group">
      <label>Button Text</label>
      <input type="text" name="btn_text" value="<%= content.btn_text || '' %>">
    </div>

    <div class="form-group">
      <label>Aquaculture Name</label>
      <input type="text" name="aquaculture_name" value="<%= content.aquaculture_name || '' %>">
    </div>

    <div class="form-group">
      <label>Characteristics</label>
      <table id="characteristicsTable">
        <tbody>
          <% (content.characteristics || []).forEach((c, index) => { %>
            <tr>
              <td>
                <input type="hidden" name="characteristics[<%= index %>][id]" value="<%= c.id %>">
                <input type="text" name="characteristics[<%= index %>][title]" value="<%= c.title %>">
              </td>
              <td>
                <input type="text" name="characteristics[<%= index %>][percent]" value="<%= c.percent %>">
              </td>
              <td>
                <button type="button" class="removeRowBtn">Remove</button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <button type="button" id="addCharBtn">Add Characteristic</button>
    <input type="submit" value="Create Content" class="create">
  </form>
</div>

<div id="imageModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Select Media</h2>
    <div class="image-grid" id="imageGrid">
      <div id="imagesContainer"><h3>Images</h3></div>
      <div id="videosContainer"><h3>Videos</h3></div>
    </div>
  </div>
</div>

<script>
  const addBtn = document.getElementById("addCharBtn");
  const tableBody = document.querySelector("#characteristicsTable tbody");

  function getNextIndex() {
    const rows = tableBody.querySelectorAll("tr");
    let maxIndex = -1;
    rows.forEach(tr => {
      const hiddenInput = tr.querySelector("input[type='hidden']");
      if (hiddenInput) {
        const match = hiddenInput.name.match(/\[(\d+)\]/);
        if (match) {
          const idx = parseInt(match[1]);
          if (idx > maxIndex) maxIndex = idx;
        }
      }
    });
    return maxIndex + 1;
  }

  addBtn.addEventListener("click", () => {
    const index = getNextIndex();
    const newRow = document.createElement("tr");
    newRow.innerHTML = `
      <td>
        <input type="hidden" name="characteristics[${index}][id]" value="">
        <input type="text" name="characteristics[${index}][title]" value="">
      </td>
      <td>
        <input type="text" name="characteristics[${index}][percent]" value="">
      </td>
      <td>
        <button type="button" class="removeRowBtn">Remove</button>
      </td>
    `;
    tableBody.appendChild(newRow);
    newRow.querySelector(".removeRowBtn").addEventListener("click", () => newRow.remove());
  });

  document.querySelectorAll(".removeRowBtn").forEach(btn => {
    btn.addEventListener("click", e => e.target.closest("tr").remove());
  });
</script>
