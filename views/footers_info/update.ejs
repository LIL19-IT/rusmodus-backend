<div class="rows">
  <h2 class="page-title">Update Footer Info</h2>

  <form action="/admin/footers_info/update/<%= id %>" method="post">
    <div class="actions">
      <input type="submit" value="Save">
      <a href="/admin/footers_info" class="back-btn">Back</a>
    </div>

    <div class="form-group">
      <label>Lang:</label>
      <input type="text" name="lang" value="<%= footer.lang %>" />
    </div>

    <div class="form-group">
      <label>Title:</label>
      <input type="text" name="title" value="<%= footer.title %>" />
    </div>

    <div class="form-group">
      <label>Tel:</label>
      <input type="text" name="tel" value="<%= footer.tel %>" />
    </div>

    <div class="form-group">
      <label>Email:</label>
      <input type="text" name="email" value="<%= footer.email %>" />
    </div>
  </form>

  <form action="/admin/footers_info/update-social-links/<%= id %>" method="post">

    <h3>Social Links</h3>
    <table id="socialLinksTable" class="table" border="1" cellpadding="8">
      <thead>
        <tr>
          <th>Image URL</th>
          <th>URL</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% (footer.social_links || []).forEach((link, index) => { %>
          <tr>
            <td>
              <input type="hidden" name="social_links[<%= index %>][id]" value="<%= link.id %>">
              <input type="text" name="social_links[<%= index %>][img_url]" value="<%= link.img_url %>">
            </td>
            <td>
              <input type="text" name="social_links[<%= index %>][url_links]" value="<%= link.url_links %>">
            </td>
            <td><button type="button" class="removeRowBtn">Remove</button></td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <div class="btn-group">
      <button type="button" id="addSocialLinkBtn">+ Add Social Link</button>
      <button type="submit">Save Links</button>
    </div>
  </form>
</div>

<script>
  const addBtn = document.getElementById("addSocialLinkBtn");
  const tableBody = document.querySelector("#socialLinksTable tbody");

  function getNextIndex() {
    const rows = tableBody.querySelectorAll("tr");
    let maxIndex = -1;
    rows.forEach(tr => {
      const hiddenInput = tr.querySelector("input[type='hidden']");
      if (hiddenInput) {
        const name = hiddenInput.name;
        const match = name.match(/\[(\d+)\]/);
        if (match) {
          const idx = parseInt(match[1]);
          if (idx > maxIndex) maxIndex = idx;
        }
      }
    });
    return maxIndex + 1;
  }

  addBtn.addEventListener("click", () => {
    const index = getNextIndex();
    const newRow = document.createElement("tr");
    newRow.innerHTML = `
      <td>
        <input type="hidden" name="social_links[${index}][id]" value="">
        <input type="text" name="social_links[${index}][img_url]" value="">
      </td>
      <td><input type="text" name="social_links[${index}][url_links]" value=""></td>
      <td><button type="button" class="removeRowBtn">Remove</button></td>
    `;
    tableBody.appendChild(newRow);
    newRow.querySelector(".removeRowBtn").addEventListener("click", () => newRow.remove());
  });

  document.querySelectorAll(".removeRowBtn").forEach(btn => {
    btn.addEventListener("click", e => e.target.closest("tr").remove());
  });
</script>
